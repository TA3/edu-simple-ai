<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
    <script src="./browser.js"></script>
    <script src="./to-svg-browser.js"></script>
    <script src="./dataset.js"></script>
</head>
<body>
    <div class="container">
            <a class="typeform-share button" href="https://taha578692.typeform.com/to/CgRJNf" data-mode="popup" style="position: fixed; right: 10px; bottom: 30px;display:inline-block;text-decoration:none;background-color:#267DDD;color:white;cursor:pointer;font-family:Helvetica,Arial,sans-serif;font-size:20px;line-height:50px;text-align:center;margin:0;height:50px;padding:0px 33px;border-radius:25px;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;" target="_blank">Short Survey </a> <script> (function() { var qs,js,q,s,d=document, gi=d.getElementById, ce=d.createElement, gt=d.getElementsByTagName, id="typef_orm_share", b="https://embed.typeform.com/"; if(!gi.call(d,id)){ js=ce.call(d,"script"); js.id=id; js.src=b+"embed.js"; q=gt.call(d,"script")[0]; q.parentNode.insertBefore(js,q) } })() </script>
        <h2>Student Overall</h2>
        <div class="inputs" >
            <input id="PR" type="number" placeholder="PR" class="score" max="100" min="0">
            <input id="PW" type="number" placeholder="PW" class="score" max="100" min="0">
            <input id="PS" type="number" placeholder="PS" class="score" max="100" min="0">
            <input id="PL" type="number" placeholder="PL" class="score" max="100" min="0">
            <input id="Att" type="number" placeholder="Att" class="score" max="100" min="0">
        </div>
        <button onclick="estimate()" class="estimate">Estimate</button>
        <div class="result">Expected: <span id="result">--</span>%</div>
        <div class="log">
                <span class="title">Log data</span>
                <span id="log">[!] Preparing neural network...</span>
            </div>

        <h2>Batch test</h2>
        <div class="inputs" >
            <input id="against" type="text" placeholder="Att" class="score" >
            <input id="interval" type="number" placeholder="Interval" class="score" max="100" min="0">
            <input id="value" type="number" placeholder="Value" class="score" max="100" min="0">
            <label for="downloadCSV">Download CSV?</label>
            <input name="downloadCSV" id="downloadCSV" type="checkbox" checked='true' class="score">
        </div>
        <button onclick="batchTest(document.getElementById('against').value,parseInt(document.getElementById('interval').value),parseInt(document.getElementById('value').value),document.getElementById('downloadCSV').checked)" class="estimate">Batch Run</button>
        <h2>Neural Network Visualization</h2>
        <div class="svg">
            <svg  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="600" height="300"><rect x="96" y="26" width="8" height="8" stroke="black" stroke-width="1" fill="rgba(0, 128, 0, 0.5)" /><line x1="50" y1="30" x2="96" y2="30" style="stroke:black;stroke-width:0.5" /><rect x="96" y="86" width="8" height="8" stroke="black" stroke-width="1" fill="rgba(0, 128, 0, 0.5)" /><line x1="50" y1="90" x2="96" y2="90" style="stroke:black;stroke-width:0.5" /><rect x="96" y="146" width="8" height="8" stroke="black" stroke-width="1" fill="rgba(0, 128, 0, 0.5)" /><line x1="50" y1="150" x2="96" y2="150" style="stroke:black;stroke-width:0.5" /><rect x="96" y="206" width="8" height="8" stroke="black" stroke-width="1" fill="rgba(0, 128, 0, 0.5)" /><line x1="50" y1="210" x2="96" y2="210" style="stroke:black;stroke-width:0.5" /><rect x="96" y="266" width="8" height="8" stroke="black" stroke-width="1" fill="rgba(0, 128, 0, 0.5)" /><line x1="50" y1="270" x2="96" y2="270" style="stroke:black;stroke-width:0.5" /><circle cx="300" cy="30" r="4" stroke="black" stroke-width="1" fill="rgba(255, 127, 80, 0.5)" /><line x1="104" y1="30" x2="296" y2="30" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="90" x2="296" y2="30" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="150" x2="296" y2="30" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="210" x2="296" y2="30" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="270" x2="296" y2="30" style="stroke:black;stroke-width:0.5" /><circle cx="300" cy="90" r="4" stroke="black" stroke-width="1" fill="rgba(255, 127, 80, 0.5)" /><line x1="104" y1="30" x2="296" y2="90" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="90" x2="296" y2="90" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="150" x2="296" y2="90" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="210" x2="296" y2="90" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="270" x2="296" y2="90" style="stroke:black;stroke-width:0.5" /><circle cx="300" cy="150" r="4" stroke="black" stroke-width="1" fill="rgba(255, 127, 80, 0.5)" /><line x1="104" y1="30" x2="296" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="90" x2="296" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="150" x2="296" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="210" x2="296" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="270" x2="296" y2="150" style="stroke:black;stroke-width:0.5" /><circle cx="300" cy="210" r="4" stroke="black" stroke-width="1" fill="rgba(255, 127, 80, 0.5)" /><line x1="104" y1="30" x2="296" y2="210" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="90" x2="296" y2="210" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="150" x2="296" y2="210" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="210" x2="296" y2="210" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="270" x2="296" y2="210" style="stroke:black;stroke-width:0.5" /><circle cx="300" cy="270" r="4" stroke="black" stroke-width="1" fill="rgba(255, 127, 80, 0.5)" /><line x1="104" y1="30" x2="296" y2="270" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="90" x2="296" y2="270" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="150" x2="296" y2="270" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="210" x2="296" y2="270" style="stroke:black;stroke-width:0.5" /><line x1="104" y1="270" x2="296" y2="270" style="stroke:black;stroke-width:0.5" /><circle cx="500" cy="150" r="4" stroke="black" stroke-width="1" fill="rgba(100, 149, 237, 0.5)" /><line x1="504" y1="150" x2="550" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="304" y1="30" x2="496" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="304" y1="90" x2="496" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="304" y1="150" x2="496" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="304" y1="210" x2="496" y2="150" style="stroke:black;stroke-width:0.5" /><line x1="304" y1="270" x2="496" y2="150" style="stroke:black;stroke-width:0.5" /></svg>
        </div>
    </div>


    <script>





// create a simple feed forward neural network with backpropagation


//const output = net.run([1, 1,1,1,1]);  // [0.987]


function log(txt, success){
    var type;
    if (success) {
        type = "[ok]"
    } else {
        type = "[!]"
    }
    var logBox = document.getElementById('log');
    logBox.innerText += " \n " + type + " " + txt;
    logBox.scrollTop = logBox.scrollHeight - logBox.clientHeight;
}
//


log('Preparing Dataset....');
var trainingData = [];
dataset.forEach(function(e){
	trainingData.push({input:[e.Attendance, e.PL, e.PR,e.PS,e.PW],output:[e.Final]})
})
log('Dataset Ready....', true);
log('Preparing Config....');

        // provide optional config object (or undefined). Defaults shown.
        const config = {
    binaryThresh: 0.5,
    hiddenLayers: [5],     // array of ints for the sizes of the hidden layers in the network
    activation: 'sigmoid',  // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
    leakyReluAlpha: 0.01,   // supported for activation type 'leaky-relu'
    inputSize: 5,
            outputSize: 1,
};
log('Config Ready....', true);
log('Preparing Neural Network....');
const net = new brain.NeuralNetwork(config);
log('Neural Network Ready....');

log('Training Neural Network....');
var network = {"sizes":[5,5,1],"layers":[{"0":{},"1":{},"2":{},"3":{},"4":{}},{"0":{"bias":-8.15433120727539,"weights":{"0":1.3286104202270508,"1":4.347071170806885,"2":3.263028144836426,"3":-0.41631877422332764,"4":2.6291747093200684}},"1":{"bias":-2.4866316318511963,"weights":{"0":-0.48715609312057495,"1":-0.2981504201889038,"2":0.9450435638427734,"3":0.32703647017478943,"4":-0.05863186717033386}},"2":{"bias":-0.8089812994003296,"weights":{"0":-2.6712543964385986,"1":3.514768123626709,"2":0.11923981457948685,"3":-1.9279494285583496,"4":-0.5971998572349548}},"3":{"bias":-2.2099549770355225,"weights":{"0":-5.046065330505371,"1":7.502602577209473,"2":1.5617976188659668,"3":-3.051419973373413,"4":-0.44095686078071594}},"4":{"bias":-2.03273868560791,"weights":{"0":-0.49851149320602417,"1":-0.3807869851589203,"2":0.5855063199996948,"3":-0.30084580183029175,"4":0.06035099923610687}}},{"0":{"bias":0.11697370558977127,"weights":{"0":3.157305955886841,"1":0.6870763301849365,"2":-1.7665326595306396,"3":-4.727635860443115,"4":0.5264731645584106}}}],"outputLookup":false,"inputLookup":false,"activation":"sigmoid","trainOpts":{"iterations":20000,"errorThresh":0.005,"log":false,"logPeriod":10,"learningRate":0.3,"momentum":0.1,"callbackPeriod":10,"beta1":0.9,"beta2":0.999,"epsilon":1e-8}};
net.fromJSON(network);
//var training = net.train(trainingData, {iterations: 20000});
//log('Training error: ' + training.error);
log('Trained and Ready...', true);
var result;
function estimate(){
    log('Calculating...');
   result = net.run([document.getElementById('Att').value/100,document.getElementById('PL').value/100,document.getElementById('PR').value/100,document.getElementById('PS').value/100,document.getElementById('PW').value/100]);
    document.getElementById("result").innerHTML = result[0]*100;
    log('Calculated value: ' + result, true);
    log('Ready for another calculation...', true);
}

function batchTest(against, interval, value, downloadCSV){
    var result = [];
    var testCase;
    for (let i = 0; i <= 100; i = i + interval) {
        switch (against) {
            case 'Att':
                    testCase = [i/100, value/100,value/100,value/100,value/100];
                break;
            case 'PR':
                    testCase = [value/100,value/100,i/100,value/100,value/100];
                break;
            case 'PW':
                    testCase = [value/100,value/100,value/100,value/100,i/100];
                break;
            case 'PL':
                    testCase = [value/100,i/100,value/100,value/100,value/100];
                break;
            case 'PS':
                    testCase = [value/100,value/100,value/100,i/100,value/100];
                break;
            default:
                console.log("use one of the following against [Att, PR, PW, PL, or PS].");
                break;
        }
        result.push({
            value: i,
            estimate: net.run(testCase)[0]
        });
    }
    if(downloadCSV){
        ConvertToCSV(result, against+'-'+interval+'-'+value+'.csv');
    }
    return result
}

function ConvertToCSV(objArray, filename) {
            var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
            var str = '';

            for (var i = 0; i < array.length; i++) {
                var line = '';
                for (var index in array[i]) {
                    if (line != '') line += ','

                    line += array[i][index];
                }

                str += line + '\r\n';
            }
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(str));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
}


    </script>
</body>
</html>

